{% extends "base.html" %}
{% load static %}

{% block title %}
    <h4>Produtos</h4>
    <span>Listagem de produtos cadastrados</span>
{% endblock title %}

{% block customcss %}
    <!-- Data Table Css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bower_components/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/pages/data-table/css/buttons.dataTables.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bower_components/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css' %}">  
{% endblock customcss %}



{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{% url 'clients_list' %}">Clientes</a>
    </li>
    <li class="breadcrumb-item"><a href="{% url 'client_update' pk=client_id %}">Lojas</a>
    </li>
    <li class="breadcrumb-item"><a href="#!">Produtos</a>
    </li>    
{% endblock breadcrumb %}

{% block content %}
<div class="row">
    <div class="col-sm-12">
        <!-- Zero config.table start -->
        <div class="card">
            <div class="card-header">
                <h5>Lista de Produtos: {{ client_name }} </h5>
                
                <a href="{% url 'item_create' client_id=client.id %}" type="button" class="btn btn-primary btn-sm waves-effect waves-light f-right d-inline-block md-trigger m-r-5"> 
                    <i class="icofont icofont-plus-circle m-r-5"></i>
                    Adicionar Produto
                </a>

                <a href="{% url 'items_upload' client_id=client.id %}" type="button" class="btn btn-inverse btn-sm waves-effect waves-light f-right d-inline-block md-trigger m-r-5"> 
                    <i class="icofont icofont-upload-alt m-r-5"></i> 
                    Importar Produtos
                </a>

                <a href="{% url 'export_items_to_excel' client.id %}" type="button" class="btn btn-inverse btn-sm btn-outline-inverse waves-effect waves-light f-right d-inline-block md-trigger m-r-5"> 
                    <i class="icofont icofont-save m-r-5"></i>
                    Exportar Cadastros
                </a>                 

                <a href="{% url 'download_file' 'ArquivoModelo.xlsx' %}" type="button" class="btn btn-inverse btn-sm btn-outline-inverse waves-effect waves-light f-right d-inline-block md-trigger m-r-5"> 
                    <i class="icofont icofont-download-alt m-r-5"></i> 
                    Baixar Modelo
                </a>  
                
                <button type="button" class="btn btn-inverse btn-sm btn-outline-inverse waves-effect waves-light f-right d-inline-block md-trigger m-r-5" data-toggle="modal" data-target="#searchModal"> 
                    <i class="icofont icofont-filter"></i>
                </button> 
                                                                   
                <span>Lista dos produtos cadastrados do cliente: {{ client_name }}</span>

            </div>
            <div class="card-block">                  
                <div class="dt-responsive table-responsive">
                    <table id="simpletable" class="table compact table-striped table-bordered nowrap " style="font-size: x-small;padding: 0rem;">
                        <thead style="font-size: xx-small;">
                        <tr>
                            <th class="text-center" style="padding-right: 0;">Código</th>
                            <th class="text-center" style="padding-right: 0;">Cód.Barras</th>
                            <th class="text-center" style="padding-right: 0;">Descrição</th>
                            <th class="text-center" style="padding-right: 0;">NCM</th>
                            <th class="text-center" style="padding-right: 0;">CEST</th>
                            <th class="text-center" style="padding-right: 0;">CFOP</th>
                            <th class="text-center" style="padding-right: 0;">CST Icms</th>
                            <th class="text-center" style="padding-right: 0;">Aliq.Icms</th>
                            <th class="text-center" style="padding-right: 0;">Aliq.IcmsRed</th>
                            <th class="text-center" style="padding-right: 0;">CBENEF</th>
                            <th class="text-center" style="padding-right: 0;">Protege</th>
                            <th class="text-center" style="padding-right: 0;">CST PIS/COFINS</th>
                            <th class="text-center" style="padding-right: 0;">Aliq.PIS</th>
                            <th class="text-center" style="padding-right: 0;">Aliq.COFINS</th>
                            <th class="text-center" style="padding-right: 0;">Nat.Receita</th>
                            <th class="text-center" style="padding-right: 0;">Ação</th>
                        </tr>
                        </thead>
                        <tbody>
                            {% if items %}
                                {% for item in items %}
                                    <tr>
                                        <td class="text-center align-middle">{{ item.code }} </td>
                                        <td class="text-center align-middle">{{ item.barcode }}</td>
                                        <td class="text-center align-middle">{{ item.description }}</td>
                                        <td class="text-center align-middle">{{ item.ncm }}</td>
                                        <td class="text-center align-middle">{{ item.cest }}</td>
                                        <td class="text-center align-middle">{{ item.cfop }}</td>
                                        <td class="text-center align-middle">{{ item.icms_cst }}</td>
                                        <td class="text-center align-middle">{{ item.icms_aliquota }}</td>
                                        <td class="text-center align-middle">{{ item.icms_aliquota_reduzida }}</td>
                                        <td class="text-center align-middle">{{ item.cbenef }}</td>
                                        <td class="text-center align-middle">{{ item.protege }}</td>
                                        <td class="text-center align-middle">{{ item.piscofins_cst.code }}</td>
                                        <td class="text-center align-middle">{{ item.pis_aliquota }}</td>
                                        <td class="text-center align-middle">{{ item.cofins_aliquota }}</td>
                                        <td class="text-center align-middle">{{ item.naturezareceita.code }}</td>
                                        <td class="text-center align-middle">                                             
                                            <a href="{% url 'item_update' client_id=client.id pk=item.id %}" type="button" class="text-center color-black">
                                                <i class="icofont icofont-ui-edit"></i>
                                            </a> 
                                        </td>                                        
                                    </tr>                                    
                                {% endfor %}
                            {% endif %}
                            
                        </tbody>
                    </table>
                </div>
                <!-- Paginação -->  
                <div class="col-lg-12 col-md-12 col-sm-12 d-flex justify-content-center">
                    <ul class="pagination">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" tabindex="-1" href="?q={{ query }}&page={{ page_obj.previous_page_number }}">Anterior</a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" tabindex="-1" href="?q={{ query }}&page=1">Anterior</a>
                            </li>                        
                        {% endif %}  

                        
                
                        {% for page_num in page_range %}
                            {% if page_num == '...' %}
                                <li class="page-item">
                                    <a class="page-link" href="#">{{ page_num }}</a>
                                </li>
                            {% elif items.number == page_num %}
                                <li class="page-item">
                                    <a class="page-link" href="#">{{ page_num }}</a>
                                </li>
                            {% else %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}                      


                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?q={{ query }}&page={{ page_obj.next_page_number }}">Próxima</a>
                            </li>
                        {% endif %}                            
                    </ul> 
                     
                </div>                
            </div>
        </div>
        <!-- Zero config.table end -->
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header p-t-5 p-b-5 color-inverse text-white">
                <h5 class="modal-title" id="searchModalLabel">Filtrar Itens</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" class="text-white">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="searchForm">
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Código</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_code">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Cód. Barras</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_barcode">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Descrição</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_description">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">NCM</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_ncm">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">CEST</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_cest">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">CFOP</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_cfop">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">CST ICMS</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_cst_icms">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Alíq. ICMS</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_icms_aliquota">
                        </div>
                    </div>                    
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Alíq. ICMS Reduz</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_icms_aliquota_reduzida">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">CBENEF</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_cbenef">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Protege</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_protege">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">CST PIS/COFINS</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_piscofins_cst">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Alíq. PIS</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_pis_aliquota">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Alíq. COFINS</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_cofins_aliquota">
                        </div>
                    </div>
                    <div class=" row">
                        <label class="col-sm-4 col-form-label">Nat. Receita</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="search_naturezareceita">
                        </div>
                    </div>                                                                                                                                                                                                                           
                </form>
            </div>
            <div class="modal-footer p-t-5 p-b-5">
                <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Fechar</button>
                <button type="button" class="btn btn-primary  btn-sm" id="applySearch">Filtrar</button>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block anotherjs %}

<!-- data-table js -->
<script src="{% static 'bower_components/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'bower_components/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'bower_components/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'bower_components/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js' %}"></script>
<script src="https://cdn.datatables.net/plug-ins/1.13.1/i18n/pt_BR.json"></script>

<script>
    /*
    $(document).ready(function() {
        var table = $('#simpletable').DataTable({
                        select: true,
                        language: {
                            url: '//cdn.datatables.net/plug-ins/2.0.7/i18n/pt-BR.json',
                        },
                    });  
        $('#applySearch').on('click', function() {
            // Apply column search based on the values in the modal
            table.column(0).search($('#search_code').val()).draw();
            table.column(1).search($('#search_barcode').val()).draw();
            table.column(2).search($('#search_description').val()).draw();
            table.column(3).search($('#search_ncm').val()).draw();
            table.column(4).search($('#search_cest').val()).draw();
            table.column(5).search($('#search_cfop').val()).draw();
            table.column(6).search($('#search_cst_icms').val()).draw();
            table.column(7).search($('#search_icms_aliquota').val()).draw();
            table.column(8).search($('#search_icms_aliquota_reduzida').val()).draw();
            table.column(9).search($('#search_cbenef').val()).draw();
            table.column(10).search($('#search_protege').val()).draw();
            table.column(11).search($('#search_piscofins_cst').val()).draw();
            table.column(12).search($('#search_pis_aliquota').val()).draw();
            table.column(13).search($('#search_cofins_aliquota').val()).draw();
            table.column(14).search($('#search_naturezareceita').val()).draw();
            // Add more columns as needed
    
            $('#searchModal').modal('hide');
        });        
    });
    */
</script>
{% endblock anotherjs %}



